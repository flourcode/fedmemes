<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FedMemes Meme Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800;900&family=Impact&display=swap" rel="stylesheet">
<style>
  /* --- Enhanced Neobrutalist Color Palette --- */
  :root {
    /* Base & Neutral Colors */
    --bg: #F5F5F0; /* Warm cream background inspired by the design examples */
    --surface-light: #FFFFFF; /* Pure white for main card surfaces */
    --surface-mid: #EFEFEF; /* Light gray for subtle variations */
    --surface-dark: #1A1A1A; /* Deep black for strong contrasts */

    /* Ink Colors */
    --ink: #000000; /* Pure black for borders and text */
    --ink-2: #2A2A2A; /* Dark gray for secondary text */
    --ink-3: #666666; /* Medium gray for tertiary text */

    /* Bold Neobrutalist Colors */
    --accent-electric: #00FF94; /* Electric green for primary actions */
    --accent-coral: #FF6B6B; /* Vibrant coral for highlights */
    --accent-yellow: #FFE066; /* Bright yellow for warnings/attention */
    --accent-blue: #4ECDC4; /* Teal blue for info elements */
    --accent-purple: #A8E6CF; /* Soft mint green for special elements */
    --accent-orange: #FF8E53; /* Warm orange for secondary actions */
    
    /* Enhanced UI properties */
    --border-width: 3px; /* Thicker borders for more impact */
    --radius-none: 0px; /* Sharp corners for true brutalist feel */
    --radius-soft: 8px; /* Minimal rounding when needed */
    --shadow-brutal: 8px 8px 0px var(--ink); /* Strong, offset shadow */
    --shadow-mega: 12px 12px 0px var(--ink); /* Extra strong shadow for key elements */
    --shadow-inset: inset 4px 4px 0px rgba(0,0,0,0.1); /* Inset shadow for depth */
  }
  
  /* --- Global Resets & Typography --- */
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; padding:0}
  body{
    background:var(--bg);
    color:var(--ink);
    font-family: 'Inter', sans-serif;
    font-weight: 600; /* Bolder base weight */
    display: flex; 
    flex-direction: column;
    line-height: 1.4;
  }

  /* Specific elements for bolder, meme-style impact font */
  .block-header,
  .brand-text,
  .btn,
  .toast {
    font-family: 'Impact', sans-serif;
    font-weight: 900;
    letter-spacing: 0.1em; /* More dramatic letter spacing */
    text-transform: uppercase;
  }

  .label {
    font-family: 'Inter', sans-serif;
    font-weight: 800; /* Bolder labels */
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-size: 14px; /* Slightly larger */
  }

  .meme-text {
      font-family: 'Impact', sans-serif;
      font-weight: 900;
  }

  .container{
    max-width:1000px; /* Slightly wider */
    margin:0 auto; 
    padding:24px;
    display:grid; 
    gap:24px; /* Larger gaps */
    flex-grow: 1; 
  }

  /* --- UI Blocks --- */
  .block{
    border:var(--border-width) solid var(--ink);
    border-radius: var(--radius-none); /* Sharp corners */
    overflow:hidden;
    box-shadow: var(--shadow-brutal);
    background: var(--surface-light);
    transform: rotate(-0.5deg); /* Subtle rotation for dynamism */
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .block:hover {
    transform: rotate(0deg) translateY(-2px);
    box-shadow: var(--shadow-mega);
  }

  .block:nth-child(even) {
    transform: rotate(0.5deg); /* Alternate rotation */
  }

  .block:nth-child(even):hover {
    transform: rotate(0deg) translateY(-2px);
  }

  .block-header{
    padding:20px 24px;
    font-size:22px;
    border-bottom:var(--border-width) solid var(--ink);
    position: relative;
    overflow: hidden;
  }

  /* Add decorative elements to headers */
  .block-header::before {
    content: "";
    position: absolute;
    top: -50%;
    right: -20px;
    width: 100px;
    height: 100px;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    transform: rotate(45deg);
  }

  .block-content{
    padding:24px;
    background:var(--surface-light);
  }

  /* --- Header Block --- */
  .header-block{
    background: linear-gradient(135deg, var(--accent-electric) 0%, var(--accent-blue) 100%);
    color: var(--ink);
    text-align:left;
    padding:32px 24px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:20px;
    border: var(--border-width) solid var(--ink);
    border-radius: var(--radius-none);
    box-shadow: var(--shadow-mega);
    transform: rotate(0deg); /* Keep header straight */
    position: relative;
    overflow: hidden;
  }

  .header-block:hover {
    transform: rotate(0deg); /* No rotation on hover */
  }

  /* Add geometric shapes to header */
  .header-block::after {
    content: "";
    position: absolute;
    top: 20px;
    right: 20px;
    width: 60px;
    height: 60px;
    background: var(--accent-yellow);
    border: var(--border-width) solid var(--ink);
    transform: rotate(45deg);
  }
  
  .logo-area{
    display:flex;
    align-items:center;
    gap:20px;
    z-index: 1;
  }
  
  .logo{
    font-size:42px;
    text-shadow: 3px 3px 0px var(--ink);
  }
  
  .brand-text{
    font-size:32px;
    letter-spacing:3px;
    text-shadow: 2px 2px 0px rgba(0,0,0,0.3);
  }
  
  .tagline{
    font-size:14px;
    opacity:0.9; 
    font-weight:600;
    letter-spacing: 0.05em;
    text-transform: none;
    margin-top: 8px;
  }

  /* --- Control Blocks --- */
  .controls-grid{
    display:grid;
    gap:24px;
    grid-template-columns:repeat(auto-fit, minmax(320px, 1fr));
  }

  .upload-block .block-header{ 
    background: var(--accent-coral); 
    color: var(--surface-light); 
  }
  .text-block .block-header{ 
    background: var(--accent-yellow); 
    color: var(--ink); 
  }
  .watermark-block .block-header{ 
    background: var(--accent-blue); 
    color: var(--ink); 
  }

  /* --- Form Controls --- */
  .control{
    margin-bottom:20px;
  }
  
  input[type="file"], textarea, input[type="text"]{
    width:100%;
    padding:16px;
    border:var(--border-width) solid var(--ink);
    border-radius: var(--radius-none);
    font-size:16px;
    font-weight:600;
    background:var(--surface-light);
    box-shadow: var(--shadow-inset);
    transition: all 0.2s ease;
    font-family: 'Inter', sans-serif;
  }
  
  textarea{
    min-height:100px;
    resize:vertical;
    font-family:inherit;
  }
  
  input:focus, textarea:focus{
    outline:none;
    border-color:var(--accent-electric);
    box-shadow: 0 0 0 4px rgba(0,255,148,0.3), var(--shadow-inset);
    transform: translateY(-2px);
  }

  /* --- Buttons --- */
  .btn{
    display:inline-block;
    padding:18px 32px;
    border:var(--border-width) solid var(--ink);
    border-radius: var(--radius-none);
    font-weight:900;
    font-size:18px;
    cursor:pointer;
    transition:all 0.15s ease;
    text-decoration:none;
    text-align:center;
    letter-spacing:0.1em;
    box-shadow: var(--shadow-brutal);
    position: relative;
    overflow: hidden;
  }

  .btn::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s ease;
  }

  .btn:hover::before {
    left: 100%;
  }
  
  .btn:hover{ 
    transform:translate(-4px, -4px);
    box-shadow: var(--shadow-mega);
  }
  .btn:active{ 
    transform:translate(4px, 4px); 
    box-shadow: 2px 2px 0px var(--ink);
  }
  
  .btn-primary{ 
    background: linear-gradient(135deg, var(--accent-electric) 0%, var(--accent-blue) 100%); 
    color: var(--ink); 
  }
  .btn-secondary{ 
    background: var(--surface-light); 
    color: var(--ink); 
  }
  .btn-share{ 
    background: linear-gradient(135deg, var(--accent-coral) 0%, var(--accent-orange) 100%); 
    color: var(--surface-light); 
  }

  /* --- Canvas Block & Polaroid Frame --- */
  .canvas-block .block-header{ 
    background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); 
    color: var(--ink); 
  }
  
  .meme-polaroid-frame {
    background: var(--surface-light);
    border: var(--border-width) solid var(--ink);
    border-radius: var(--radius-none);
    box-shadow: var(--shadow-brutal);
    padding: 12px 12px 60px 12px;
    position: relative;
    max-width: 520px;
    margin: 0 auto 24px auto;
    display: flex;
    justify-content: center;
    align-items: center;
    transform: rotate(-1deg);
    transition: transform 0.3s ease;
  }

  .meme-polaroid-frame:hover {
    transform: rotate(0deg) scale(1.02);
  }

  .meme-polaroid-frame::after {
    content: "📸 FEDMEMES.COM";
    position: absolute;
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
    font-family: 'Impact', sans-serif;
    font-size: 14px;
    font-weight: 900;
    color: var(--ink-3);
    letter-spacing: 0.1em;
  }

  .meme-canvas{
    position:relative;
    width:100%;
    aspect-ratio:1/1;
    overflow:hidden;
    background:var(--surface-mid);
    border: var(--border-width) solid var(--ink);
    border-radius: var(--radius-none);
  }
  
  .meme-bg{
    position:absolute;
    inset:0;
    background-position:center;
    background-size:cover;
    background-repeat:no-repeat;
  }
  
  .meme-text{
    position:absolute;
    width:90%;
    left:50%;
    transform:translateX(-50%);
    color:#fff;
    font-weight:900;
    text-align:center;
    font-size:32px;
    text-shadow: 4px 4px 0 var(--ink), -4px -4px 0 var(--ink), 4px -4px 0 var(--ink), -4px 4px 0 var(--ink);
    line-height:1.1;
  }
  
  .top-text{ top:20px; }
  .bottom-text{ bottom:20px; }
  
  .watermark{
    position:absolute;
    bottom:8px;
    left:8px;
    font-size:16px;
    color:rgba(255,255,255,0.9);
    text-shadow: 3px 3px 0 var(--ink);
    font-weight:900;
  }

  .action-buttons{
    display:flex;
    gap:20px;
    justify-content:center;
    flex-wrap:wrap;
  }

  .generate-btn-container {
      margin-top: 24px;
      text-align: center;
  }
  .generate-btn-container .btn {
      width: 100%;
      max-width: 350px;
      font-size: 20px;
      padding: 20px 40px;
  }

  /* --- Examples Block --- */
  .examples-block .block-header{ 
    background: linear-gradient(135deg, var(--accent-yellow) 0%, var(--accent-orange) 100%); 
    color: var(--ink); 
  }
  
  .examples-grid{
    display:grid;
    gap:16px;
    grid-template-columns:repeat(auto-fit, minmax(280px, 1fr));
  }
  
  .example{
    padding:20px;
    border:var(--border-width) solid var(--ink);
    border-radius: var(--radius-none);
    background:var(--surface-light);
    cursor:pointer;
    transition:all 0.2s ease;
    font-size:14px;
    box-shadow: 4px 4px 0px var(--ink);
    position: relative;
    overflow: hidden;
  }

  .example::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--accent-electric);
    transform: scaleY(0);
    transition: transform 0.3s ease;
  }

  .example:hover::before {
    transform: scaleY(1);
  }
  
  .example:hover{ 
    transform:translate(-4px, -4px); 
    box-shadow: 8px 8px 0px var(--ink); 
    background-color: var(--surface-mid);
  }
  .example:active{ 
    transform:translate(2px, 2px); 
    box-shadow: 2px 2px 0px var(--ink); 
  }
  
  .example strong{
    color:var(--ink);
    display:block;
    margin-bottom:8px;
    font-family: 'Inter', sans-serif;
    font-weight: 800;
    font-size: 15px;
  }
  
  .example em{
    color:var(--ink-2);
    font-style:normal;
    font-weight:600;
    font-family: 'Inter', sans-serif;
  }

  /* --- Stock Images Block --- */
  .images-block .block-header{ 
    background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%); 
    color: var(--ink); 
  }
  
  .gallery{
    display:grid;
    gap:16px;
    grid-template-columns:repeat(auto-fit, minmax(120px, 1fr));
  }
  
  .gallery-img{
    aspect-ratio:1/1;
    background:#ddd center/cover no-repeat;
    border:var(--border-width) solid var(--ink);
    border-radius: var(--radius-none);
    cursor:pointer;
    transition:all 0.2s ease;
    box-shadow: 4px 4px 0px var(--ink);
    position: relative;
    overflow: hidden;
  }

  .gallery-img::after {
    content: "";
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0);
    transition: background 0.3s ease;
  }

  .gallery-img:hover::after {
    background: rgba(0,255,148,0.2);
  }
  
  .gallery-img:hover{ 
    transform:translate(-2px, -2px) scale(1.05); 
    box-shadow: 6px 6px 0px var(--ink); 
  }
  
  .gallery-img.selected{ 
    border-color:var(--accent-electric);
    box-shadow: 0 0 0 4px var(--accent-electric), 4px 4px 0px var(--ink);
    transform: scale(1.05);
  }

  /* --- Toast --- */
  .toast{
    position:fixed;
    bottom:30px;
    left:50%;
    transform:translateX(-50%);
    background:var(--surface-dark);
    color:#fff;
    padding:20px 32px;
    border:var(--border-width) solid var(--ink);
    border-radius: var(--radius-none);
    font-weight:900;
    font-size:16px;
    z-index:1000;
    opacity:0;
    transition:all 0.3s ease;
    box-shadow: var(--shadow-brutal);
  }
  
  .toast.show{ 
    opacity:1; 
    transform:translateX(-50%) translateY(-8px) rotate(-1deg); 
  }

  /* --- Footer Styles --- */
  .footer-block {
    margin-top: 40px;
    background: var(--surface-dark);
    color: #fff;
    padding: 32px 24px;
    text-align: center;
    font-size: 14px;
    border-top: 6px solid var(--accent-electric);
    font-family: 'Inter', sans-serif;
    font-weight: 600;
    transform: rotate(0deg); /* Keep footer straight */
  }

  .footer-block:hover {
    transform: rotate(0deg); /* No rotation on hover */
  }

  .footer-block p {
    margin: 0 0 12px 0;
    line-height: 1.6;
  }

  .footer-block a {
    color: var(--accent-yellow);
    text-decoration: none;
    font-weight: 800;
    transition: color 0.2s ease;
    border-bottom: 2px solid transparent;
  }

  .footer-block a:hover {
    color: var(--accent-electric);
    border-bottom-color: var(--accent-electric);
  }

  /* --- Mobile Responsive --- */
  @media(max-width:768px){
    .container {
      padding: 16px;
      gap: 20px;
    }
    
    .controls-grid{
      grid-template-columns:1fr;
    }
    .examples-grid{
      grid-template-columns:1fr;
    }
    .gallery{
      grid-template-columns:repeat(3, 1fr);
    }
    .action-buttons{
      flex-direction:column;
    }
    .btn{
      width:100%;
      font-size: 16px;
      padding: 16px 24px;
    }
    .header-block{
      flex-direction:column;
      text-align:center;
      padding: 24px 20px;
    }
    .block {
        box-shadow: 4px 4px 0px var(--ink);
        transform: rotate(0deg); /* Less rotation on mobile */
    }
    .block:hover {
      transform: translateY(-2px);
    }
    .meme-polaroid-frame {
        padding: 8px 8px 45px 8px;
        box-shadow: 4px 4px 0px var(--ink);
        transform: rotate(0deg);
    }
    .meme-polaroid-frame:hover {
      transform: scale(1.02);
    }
    .generate-btn-container .btn {
      max-width: 100%;
      font-size: 18px;
    }
    .brand-text {
      font-size: 28px;
    }
    .logo {
      font-size: 36px;
    }
  }

  /* Subtle hover animations only - no floating */
  .block {
    transform: rotate(-0.5deg); /* Subtle rotation for dynamism */
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .block:hover {
    transform: rotate(0deg) translateY(-2px);
    box-shadow: var(--shadow-mega);
  }

  .block:nth-child(even) {
    transform: rotate(0.5deg); /* Alternate rotation */
  }

  .block:nth-child(even):hover {
    transform: rotate(0deg) translateY(-2px);
  }
</style>
</head>
<body>
  <div class="container">
    <div class="block header-block">
      <div class="logo-area">
        <div class="logo">🏛️</div>
        <div>
          <div class="brand-text">FEDMEMES</div>
          <div class="tagline">Turning bureaucracy into comedy since 2025</div>
        </div>
      </div>
    </div>

    <div class="block canvas-block">
      <div class="block-header">🖼️ Your Meme Masterpiece</div>
      <div class="block-content">
        <div class="meme-polaroid-frame">
          <div class="meme-canvas" id="memeCanvas">
            <div class="meme-bg" id="memeBg"></div>
            <div class="meme-text top-text" id="topTextEl">NOBODY:</div>
            <div class="meme-text bottom-text" id="bottomTextEl">ME FILLING OUT MY 47TH FORM TODAY</div>
            <div class="watermark" id="watermarkEl"></div>
          </div>
        </div>
        
        <div style="text-align:center; margin-bottom:16px; color:var(--ink-3); font-size:14px; font-family: 'Inter', sans-serif; font-weight: 600;">
          Click "Generate Meme" to create your final version
        </div>

        <div class="generate-btn-container">
          <button class="btn btn-primary" id="generateBtn">🚀 Generate Meme</button>
        </div>
        
        <div class="action-buttons" style="margin-top: 24px;">
          <button class="btn btn-secondary" id="downloadBtn">💾 Download</button>
          <button class="btn btn-share" id="copyShareBtn">📋 Copy & Share</button>
        </div>
      </div>
    </div>

    <div class="controls-grid">
      <div class="block upload-block">
        <div class="block-header">📁 Upload Image</div>
        <div class="block-content">
          <div class="control">
            <label class="label">Choose Your File</label>
            <input type="file" id="imageUpload" accept="image/*" />
          </div>
        </div>
      </div>

      <div class="block text-block">
        <div class="block-header">✏️ Customize Text</div>
        <div class="block-content">
          <div class="control">
            <label class="label">Top Text</label>
            <textarea id="topText" placeholder="Enter top text...">Nobody:</textarea>
          </div>
          <div class="control">
            <label class="label">Bottom Text</label>
            <textarea id="bottomText" placeholder="Enter bottom text...">Me filling out my 47th form today</textarea>
          </div>
        </div>
      </div>

      <div class="block watermark-block">
        <div class="block-header">🏷️ Add Watermark</div>
        <div class="block-content">
          <div class="control">
            <label class="label">Your Handle (Optional)</label>
            <input type="text" id="watermark" placeholder="@yourusername" />
          </div>
        </div>
      </div>
    </div>

    <div class="block images-block">
      <div class="block-header">🖼️ Choose Stock Photo</div>
      <div class="block-content">
        <div class="gallery" id="gallery"></div>
        <div style="text-align:center; margin-top:16px; font-size:13px; color:var(--ink-3); font-family: 'Inter', sans-serif; font-weight: 600;">
          Click an image to use as background
        </div>
      </div>
    </div>

    <div class="block examples-block">
      <div class="block-header">🎲 Quick Examples</div>
      <div class="block-content">
        <div class="examples-grid" id="examples"></div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>
  <canvas id="exportCanvas" style="display:none;"></canvas>

  <footer class="footer-block">
    <p>&copy; 2025 FedMemes.com. All rights reserved.</p>
    <p>
      For DMCA Takedown requests, please email 
      <a href="mailto:dmca.takedown@example.com">dmca.takedown@example.com</a>.
    </p>
  </footer>

<script>
// Government/Federal employee meme examples
const EXAMPLES = [
  { top: "POV: Friday 4:59", bottom: "New RFQ. Due Monday" },
  { top: "Industry Day", bottom: "Free coffee. Zero answers" },
  { top: "SAM.gov", bottom: "Draft since 2019" },
  { top: "FedRAMP status", bottom: "In Process. So am I" },
  { top: "Teaming call", bottom: "Friends at hello. Enemies at pricing" },
  { top: "OCI check", bottom: "You are fine. Until you are not" },
  { top: "Orals deck", bottom: "30 minutes. 120 slides" },
  { top: "Compliance matrix", bottom: "Sudoku for SIs" },
  { top: "NAICS code", bottom: "Never the one we do" },
  { top: "Set aside question", bottom: "Set aside my hopes" },
  { top: "Small biz partner", bottom: "The real MVP" },
  { top: "Prime asks for capabilities", bottom: "They mean rates" },
  { top: "SubK margin", bottom: "Thoughts and prayers" },
  { top: "Price to win", bottom: "Spreadsheet. And vibes" },
  { top: "Sources Sought", bottom: "Sought too late" },
  { top: "Kickoff call", bottom: "Everyone muted. One dog unmuted" },
  { top: "FedRAMP logo slide", bottom: "Bigger than the product" },
  { top: "Free Cloud credits", bottom: "Forgot to turn off RDS" },
  { top: "How much is ProServe", bottom: "How much do you have" },
  { top: "Proposal due date", bottom: "Holiday weekend. Of course" },
  { top: "Questions due", bottom: "Already closed" },
  { top: "Contract vehicle", bottom: "Not our vehicle." },
  { top: "Invoice portal", "bottom": "Password expired during login" },
  { top: "CPARS", bottom: "Five stars. Lost on price" },
  { top: "Task order drop", bottom: "Midnight. Timezone unknown" },
  { top: "Past perf crosswalk", bottom: "Archeology with highlighters" },
  { top: "FPDS safari", bottom: "Found our rival flourishing" },
  { top: "SAM UEI", bottom: "On a Post it somewhere" },
  { top: "Agency forecast", bottom: "PDF from 2017" },
  { top: "Orals prep", bottom: "Answers rehearsed. Wrong questions" },
  { top: "CUI labeling", bottom: "Desktop looks like a ransom note" },
  { top: "Opening LinkedIn", bottom: "Congratulations on your congratulations" },
  { top: "GovCloud estimate", bottom: "Surprise party" },
  { top: "IL5 timeline", bottom: "In dog years" }
];

// Stock background images
const STOCK_IMAGES = [
  "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=400&fit=crop&crop=face",
  "https://images.unsplash.com/photo-1494790108755-2616c96d3ebe?w=400&h=400&fit=crop&crop=face",
  "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=400&h=400&fit=crop&crop=face",
  "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=400&h=400&fit=crop&crop=face",
  "https://images.unsplash.com/photo-1560250097-0b93528c311a?w=400&h=400&fit=crop&crop=face",
  "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=400&h=400&fit=crop&crop=face",
  "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=400&h=400&fit=crop&crop=face",
  "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=400&h=400&fit=crop&crop=face",
  "https://images.unsplash.com/photo-1521572267360-ee0c2909d518?w=400&h=400&fit=crop&crop=face"
];

// Elements
const topText = document.getElementById('topText');
const bottomText = document.getElementById('bottomText');
const watermark = document.getElementById('watermark');
const topTextEl = document.getElementById('topTextEl');
const bottomTextEl = document.getElementById('bottomTextEl');
const watermarkEl = document.getElementById('watermarkEl');
const memeBg = document.getElementById('memeBg');
const imageUpload = document.getElementById('imageUpload');
const gallery = document.getElementById('gallery');
const examples = document.getElementById('examples');
const generateBtn = document.getElementById('generateBtn');
const downloadBtn = document.getElementById('downloadBtn');
const copyShareBtn = document.getElementById('copyShareBtn');
const toast = document.getElementById('toast');
const exportCanvas = document.getElementById('exportCanvas');

let currentImage = null;
let generatedMemeBlob = null;

// Initialize
function init() {
  const initialExample = EXAMPLES[Math.floor(Math.random() * EXAMPLES.length)];
  currentImage = STOCK_IMAGES[0];
  
  memeBg.style.backgroundImage = `url(${currentImage})`;
  
  topText.value = initialExample.top;
  bottomText.value = initialExample.bottom;

  setupExamples();
  setupGallery();
  setupEventListeners();
  updateMeme();
}

function setupExamples() {
  examples.innerHTML = '';
  EXAMPLES.forEach(example => {
    const div = document.createElement('div');
    div.className = 'example';
    div.innerHTML = `<strong>"${example.top}"</strong><em>"${example.bottom}"</em>`;
    div.onclick = () => {
      topText.value = example.top;
      bottomText.value = example.bottom;
      updateMeme();
      showToast('Example loaded! 🎉');
    };
    examples.appendChild(div);
  });
}

function setupGallery() {
  gallery.innerHTML = '';
  STOCK_IMAGES.forEach((url, index) => {
    const div = document.createElement('div');
    div.className = 'gallery-img';
    div.style.backgroundImage = `url(${url})`;
    
    if (index === 0) {
      div.classList.add('selected');
    }
    
    div.onclick = () => {
      document.querySelectorAll('.gallery-img').forEach(img => img.classList.remove('selected'));
      div.classList.add('selected');
      currentImage = url;
      memeBg.style.backgroundImage = `url(${url})`;
      showToast('Image selected! 📸');
    };
    gallery.appendChild(div);
  });
}

function setupEventListeners() {
  topText.addEventListener('input', updateMeme);
  bottomText.addEventListener('input', updateMeme);
  watermark.addEventListener('input', updateMeme);
  
  imageUpload.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        currentImage = e.target.result;
        memeBg.style.backgroundImage = `url(${currentImage})`;
        document.querySelectorAll('.gallery-img').forEach(img => img.classList.remove('selected'));
        showToast('Custom image uploaded! 🖼️');
      };
      reader.readAsDataURL(file);
    }
  });

  generateBtn.addEventListener('click', generateMeme);
  downloadBtn.addEventListener('click', downloadMeme);
  copyShareBtn.addEventListener('click', copyAndShare);
}

function updateMeme() {
  topTextEl.textContent = topText.value.toUpperCase();
  bottomTextEl.textContent = bottomText.value.toUpperCase();
  watermarkEl.textContent = watermark.value;
  watermarkEl.style.display = watermark.value ? 'block' : 'none';
}

async function generateMeme() {
  const canvas = exportCanvas;
  const ctx = canvas.getContext('2d');
  canvas.width = 800;
  canvas.height = 800;

  ctx.fillStyle = '#000';
  ctx.fillRect(0, 0, 800, 800);

  if (currentImage) {
    const img = new Image();
    img.crossOrigin = 'anonymous';
    await new Promise((resolve, reject) => {
      img.onload = () => {
        ctx.drawImage(img, 0, 0, 800, 800);
        resolve();
      };
      img.onerror = () => {
        console.error('Failed to load image for canvas:', currentImage);
        resolve();
      };
      img.src = currentImage;
    });
  }

  ctx.fillStyle = '#fff';
  ctx.strokeStyle = '#000';
  ctx.lineWidth = 4;
  ctx.textAlign = 'center';
  ctx.font = 'bold 48px Impact, Arial';

  const topLines = wrapText(ctx, topText.value.toUpperCase(), 750);
  topLines.forEach((line, i) => {
    const y = 80 + (i * 60);
    ctx.strokeText(line, 400, y);
    ctx.fillText(line, 400, y);
  });

  const bottomLines = wrapText(ctx, bottomText.value.toUpperCase(), 750);
  bottomLines.reverse().forEach((line, i) => {
    const y = 720 - (i * 60);
    ctx.strokeText(line, 400, y);
    ctx.fillText(line, 400, y);
  });

  if (watermark.value) {
    ctx.font = 'bold 24px Arial';
    ctx.fillStyle = 'rgba(255,255,255,0.8)';
    ctx.strokeStyle = '#000';
    ctx.lineWidth = 2;
    ctx.textAlign = 'left';
    ctx.strokeText(watermark.value, 20, 770);
    ctx.fillText(watermark.value, 20, 770);
  }

  return new Promise((resolve) => {
    canvas.toBlob((blob) => {
      generatedMemeBlob = blob;
      showToast('Meme generated! Ready to share 🎉');
      resolve(blob);
    }, 'image/png');
  });
}

async function downloadMeme() {
  if (!generatedMemeBlob) {
    await generateMeme();
  }
  
  const url = URL.createObjectURL(generatedMemeBlob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `fedmeme-${Date.now()}.png`;
  a.click();
  URL.revokeObjectURL(url);
  showToast('Meme downloaded! 💾 Find it in your downloads folder.');
}

async function copyAndShare() {
    if (!generatedMemeBlob) {
        await generateMeme();
    }

    // Try to copy the image to clipboard first (works on most modern browsers)
    try {
        const item = new ClipboardItem({'image/png': generatedMemeBlob});
        await navigator.clipboard.write([item]);
        showToast('Meme copied to clipboard! 📋 Now paste it anywhere you want to share.');
        return;
    } catch (err) {
        console.warn('Failed to copy image to clipboard:', err);
    }

    // Fallback: Try Web Share API for mobile devices
    if (navigator.share) {
        try {
            const shareData = {
                title: 'Check out this FedMeme!',
                files: [new File([generatedMemeBlob], 'fedmeme.png', { type: 'image/png' })]
            };
            
            if (navigator.canShare && navigator.canShare(shareData)) {
                await navigator.share(shareData);
                showToast('Meme shared successfully! 🎉');
                return;
            }
        } catch (error) {
            console.warn('Web Share API failed:', error);
        }
    }

    // Final fallback: Download the meme
    showToast('Copying not supported on this device. Downloading meme instead...');
    downloadMeme();
}

function wrapText(ctx, text, maxWidth) {
  const words = text.split(' ');
  const lines = [];
  let currentLine = words[0];

  for (let i = 1; i < words.length; i++) {
    const word = words[i];
    const width = ctx.measureText(currentLine + ' ' + word).width;
    if (width < maxWidth) {
      currentLine += ' ' + word;
    } else {
      lines.push(currentLine);
      currentLine = word;
    }
  }
  lines.push(currentLine);
  return lines;
}

function showToast(message) {
  toast.textContent = message;
  toast.classList.add('show');
  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000);
}

// Start the app
init();
</script>
</body>
</html>